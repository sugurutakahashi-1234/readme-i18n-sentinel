# Run existing commitlint
bunx --no-install commitlint --edit $1 --config commitlint.config.ts

# Check README translations if README.md is modified
README_FILE='README.md'
I18N_SKIP_FLAG='[i18n-skip]'

if git diff --cached --name-only | grep -q "^${README_FILE}$"; then
  if ! grep -q "${I18N_SKIP_FLAG}" "$1"; then
    echo "üìñ Checking README translations..."
    bun run readme-i18n-sentinel || exit 1
  else
    echo "üìñ Skipping README translation check due to ${I18N_SKIP_FLAG} flag"
  fi
fi

# Check dependency graph changes
DEPS_GRAPH_FILE='docs/reports/dependencies/layers.md'
DEPS_ACK_FLAG='[deps-change]'

if git diff --cached --name-only | grep -qx "${DEPS_GRAPH_FILE}"; then
  if ! grep -qF "${DEPS_ACK_FLAG}" "$1"; then
    echo ""
    echo "‚ùå Dependency graph changed"
    echo ""
    echo "The file ${DEPS_GRAPH_FILE} has been modified."
    echo "Please add '${DEPS_ACK_FLAG}' to your commit message to acknowledge this change."
    echo ""
    echo "Example: feat: add new library ${DEPS_ACK_FLAG}"
    echo ""
    exit 1
  else
    echo "üìä Dependency graph change acknowledged with ${DEPS_ACK_FLAG} flag"
  fi
fi
